---
description: Actualiza documentaci√≥n basado en commits pendientes o an√°lisis de inconsistencias
argument-hint: "[opcional: foco espec√≠fico si no hay commits]"
allowed-tools: Bash(git *), Read, Edit, Grep, Glob, AskUserQuestion, TodoWrite
---

# Documentation Auto-Update

Actualiza documentaci√≥n del proyecto mediante ingenier√≠a inversa de commits pendientes o an√°lisis proactivo de inconsistencias.

**Agn√≥stico:** Funciona en cualquier proyecto, detecta estructura autom√°ticamente.

**Input:** `$ARGUMENTS` (opcional, usado en modo an√°lisis enfocado)

## Paso 0: Detecci√≥n Autom√°tica del Proyecto

Ejecutar bash para detectar estructura:

```bash
# 1. Detectar directorio de documentaci√≥n
for dir in docs documentation doc wiki manual handbook guide; do
  [ -d "$dir" ] && DOCS_DIR="$dir" && break
done
[ -z "$DOCS_DIR" ] && DOCS_DIR="."

echo "üìÅ Docs directory: $DOCS_DIR"

# 2. Detectar sistema de build
BUILD_CMD=""
if [ -f "package.json" ]; then
  if grep -q "vitepress\|docusaurus\|nextra" package.json; then
    # Extraer comando de scripts
    if grep -q '"docs:build"' package.json; then
      BUILD_CMD="npm run docs:build"
    elif grep -q '"build"' package.json; then
      BUILD_CMD="npm run build"
    fi
    echo "üîß Build system: npm ($BUILD_CMD)"
  fi
elif [ -f "mkdocs.yml" ]; then
  BUILD_CMD="mkdocs build --strict"
  echo "üîß Build system: MkDocs"
elif [ -f "docusaurus.config.js" ]; then
  BUILD_CMD="npm run build"
  echo "üîß Build system: Docusaurus"
elif [ -f "_config.yml" ]; then
  BUILD_CMD="bundle exec jekyll build"
  echo "üîß Build system: Jekyll"
else
  echo "üìù Build system: None (plain markdown)"
fi

# 3. Detectar commits pendientes
commit_count=$(git rev-list --count origin/main..HEAD 2>/dev/null || echo "0")

if [ "$commit_count" -eq 0 ]; then
  echo "‚úÖ No hay commits pendientes"
  MODE="analysis"
else
  echo "üì¶ $commit_count commits pendientes detectados"
  MODE="reverse_engineering"
fi

# Save state
git config --local docs.update.dir "$DOCS_DIR" 2>/dev/null || true
git config --local docs.update.build "$BUILD_CMD" 2>/dev/null || true
git config --local docs.update.mode "$MODE" 2>/dev/null || true
```

Seg√∫n MODE, continuar con **FLUJO A** o **FLUJO B**.

---

## FLUJO A: Ingenier√≠a Inversa (Commits Pendientes)

### A1. Analyze Pending Commits

Ejecutar bash:

```bash
# Get pending commits with file changes
git log origin/main..HEAD --oneline --name-status --no-merges > /tmp/pending_commits.txt
git diff --name-status origin/main..HEAD > /tmp/changed_files.txt

# Show summary
echo "=== Commits Analizados ==="
git log origin/main..HEAD --oneline --no-merges
echo ""
echo "=== Archivos .md Modificados ==="
git diff --name-status origin/main..HEAD | grep '\.md$'
```

Claude debe analizar archivos .md modificados gen√©ricamente (sin asumir estructura).

### A2. Identify Documentation Impact

Para cada archivo .md modificado o renombrado:

1. **Extraer nombre del archivo** (ej: `path/to/file.md` ‚Üí `file`)
2. **Buscar referencias** en directorio de docs:
   ```
   DOCS_DIR=$(git config --local docs.update.dir)
   Grep pattern: "{filename}" (sin extensi√≥n)
   Path: $DOCS_DIR/**/*.md
   Output: content con l√≠neas
   ```
3. **Archivos renombrados:** Detectar `R0XX old new` ‚Üí buscar old en docs

Crear mapa de impacto:

```
{docs_dir}/guide.md: L√≠nea X (referencia a archivo modificado)
{docs_dir}/README.md: L√≠nea Y (link a archivo renombrado)
```

### A3. Generate Update Plan

Mostrar plan estructurado:

```markdown
## Plan de Actualizaci√≥n

### Cambios Detectados

- Commits: {count}
- Archivos .md modificados: {list}

### Impactos en Documentaci√≥n

**{docs_dir}/file.md:**

- L√≠nea {num}: {descripci√≥n}

### Validaciones

- [ ] Build system (si existe)
- [ ] Links v√°lidos
```

### A4. Request Authorization

Usar AskUserQuestion:

```
Pregunta: "¬øProceder con actualizaciones?"
Options: S√≠/No
```

Si "No" ‚Üí exit. Si "S√≠" ‚Üí A5.

### A5. Execute Updates

Para cada cambio:

1. Read + Edit quir√∫rgico
2. Mostrar progreso

Validar build (si existe):

```bash
DOCS_DIR=$(git config --local docs.update.dir)
BUILD_CMD=$(git config --local docs.update.build)

if [ -n "$BUILD_CMD" ]; then
  echo "Validating build..."
  eval "$BUILD_CMD" 2>&1 | tail -10
  [ $? -ne 0 ] && echo "‚ùå Build failed" && exit 1
  echo "‚úÖ Build passed"
fi
```

Crear commit:

```bash
git add "$DOCS_DIR/"

git commit -m "docs: update documentation based on recent changes

Auto-generated by /update-docs
Commits analyzed: $(git log origin/main..HEAD --oneline --no-merges | wc -l)
Files updated: $(git diff --cached --name-only | wc -l)"

echo "‚úÖ Documentation updated"
```

---

## FLUJO B: An√°lisis de Inconsistencias (Sin Commits)

### B1. Request Analysis Mode

Usar AskUserQuestion:

```
Pregunta: "¬øQu√© an√°lisis realizar?"
Options:
  - An√°lisis global (toda la documentaci√≥n)
  - An√°lisis enfocado (archivo/secci√≥n espec√≠fica)
  - Cancelar
```

### B2. Execute Analysis

**MODO GLOBAL:**

```bash
DOCS_DIR=$(git config --local docs.update.dir)

# Find all .md files in docs directory
find "$DOCS_DIR" -name "*.md" -type f > /tmp/docs_files.txt
```

Para cada archivo:

- **Links rotos:** `[text](path)` donde path no existe (relativo al proyecto)
- **Referencias obsoletas:** Menciones a archivos .md que no existen
- **Versiones:** Si existe `package.json`, comparar versiones mencionadas

**MODO FOCUSED:**

1. Foco: `$ARGUMENTS` o preguntar
2. Glob/Read archivos espec√≠ficos
3. Mismo an√°lisis enfocado

**Output:**

```markdown
## An√°lisis de Inconsistencias

### Archivos: {count}

### Problemas

**Links Rotos ({count}):**

- {file}: L√≠nea X: [text](broken-path)

**Referencias Obsoletas ({count}):**

- {file}: L√≠nea Y: Menciona archivo inexistente

**Versiones ({count}):**

- {file}: L√≠nea Z: v{old} ‚Üí actual v{new}
```

### B3. Generate Correction Plan

```markdown
## Plan de Correcci√≥n

**{file}:**

- L√≠nea X: Fix ‚Üí Actual/Propuesto

### Validaciones

- [ ] Build system, [ ] Links v√°lidos
```

### B4. Request Authorization

AskUserQuestion: "¬øProceder con correcciones?" S√≠/No

### B5. Execute Corrections

Igual que A5: edits + validar build + commit.

```bash
git commit -m "docs: fix inconsistencies found by analysis

Auto-generated by /update-docs (analysis mode)
Corrections: {summary}
Files: $(git diff --cached --name-only | wc -l)"
```

---

## Error Handling

```
Sin commits + cancelado: "‚ÑπÔ∏è An√°lisis cancelado"
Todo actualizado: "‚úÖ Docs actualizada"
Build falla: "‚ùå Build failed. Revertir: git restore {docs_dir}/"
Usuario rechaza: "‚ÑπÔ∏è Actualizaci√≥n cancelada"
```

---

## Notas

**Agn√≥stico:** Detecta estructura autom√°ticamente, funciona en cualquier proyecto

**Detecci√≥n:** Docs dir, build system, sin asumir paths espec√≠ficos

**Gen√©rico:** Analiza .md modificados, busca referencias, sin hardcoded structure

**Portable:** VitePress, MkDocs, Docusaurus, Jekyll, plain markdown
